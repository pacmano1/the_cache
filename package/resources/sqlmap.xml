<?xml version="1.0" encoding="UTF-8"?>

<!-- SPDX-License-Identifier: MPL-2.0 -->
<!-- Copyright (c) 2026 Diridium <https://diridium.com> -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "conf/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CacheDefinition">

    <!-- ========== Result Maps ========== -->

    <resultMap id="cacheDefinitionResult" type="map">
        <result property="id" column="id" javaType="String" />
        <result property="name" column="name" javaType="String" />
        <result property="enabled" column="enabled" javaType="Boolean" />
        <result property="driver" column="driver" javaType="String" />
        <result property="url" column="url" javaType="String" />
        <result property="username" column="username" javaType="String" />
        <result property="password" column="password" javaType="String" />
        <result property="useJavaScript" column="use_javascript" javaType="Boolean" />
        <result property="query" column="query" javaType="String" />
        <result property="keyColumn" column="key_column" javaType="String" />
        <result property="valueColumn" column="value_column" javaType="String" />
        <result property="maxSize" column="max_size" javaType="Long" />
        <result property="evictionDurationMinutes" column="eviction_duration_minutes" javaType="Long" />
    </resultMap>

    <!-- ========== Queries ========== -->

    <insert id="insert" parameterType="map">
        INSERT INTO cache_definition (
            id, name, enabled,
            driver, url, username, password, use_javascript, query,
            key_column, value_column, max_size, eviction_duration_minutes,
            created_at, updated_at
        ) VALUES (
            #{id}, #{name}, #{enabled},
            #{driver}, #{url}, #{username}, #{password}, #{useJavaScript}, #{query},
            #{keyColumn}, #{valueColumn}, #{maxSize}, #{evictionDurationMinutes},
            #{createdAt}, #{updatedAt}
        )
    </insert>

    <update id="update" parameterType="map">
        UPDATE cache_definition SET
            name = #{name},
            enabled = #{enabled},
            driver = #{driver},
            url = #{url},
            username = #{username},
            password = #{password},
            use_javascript = #{useJavaScript},
            query = #{query},
            key_column = #{keyColumn},
            value_column = #{valueColumn},
            max_size = #{maxSize},
            eviction_duration_minutes = #{evictionDurationMinutes},
            updated_at = #{updatedAt}
        WHERE id = #{id}
    </update>

    <delete id="delete" parameterType="String">
        DELETE FROM cache_definition WHERE id = #{value}
    </delete>

    <select id="getById" parameterType="String" resultMap="cacheDefinitionResult">
        SELECT id, name, enabled,
               driver, url, username, password, use_javascript, query,
               key_column, value_column, max_size, eviction_duration_minutes
        FROM cache_definition
        WHERE id = #{value}
    </select>

    <select id="getAll" resultMap="cacheDefinitionResult">
        SELECT id, name, enabled,
               driver, url, username, password, use_javascript, query,
               key_column, value_column, max_size, eviction_duration_minutes
        FROM cache_definition
        ORDER BY name
    </select>

    <select id="getByName" parameterType="String" resultMap="cacheDefinitionResult">
        SELECT id, name, enabled,
               driver, url, username, password, use_javascript, query,
               key_column, value_column, max_size, eviction_duration_minutes
        FROM cache_definition
        WHERE name = #{value}
    </select>

</mapper>
